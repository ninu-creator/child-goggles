<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Child Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #map { height: 500px; width: 100%; margin-top: 10px; }
        #status { font-size: 18px; font-weight: bold; color: green; }
        #alertBox { display: none; background: red; color: white; padding: 10px; font-size: 20px; margin-top: 10px; }
        #safeZoneInfo { margin-top: 10px; font-size: 16px; }
    </style>
</head>
<body>

    <h2>Child Tracker - Live GPS Location</h2>
    <p id="status">Waiting for location updates...</p>
    <div id="alertBox">ðŸš¨ ALERT: Child is OUTSIDE the Safe Zone! ðŸš¨</div>
    <div id="safeZoneInfo">Safe Zone: Center (12.9716, 77.5946), Radius: 500m</div>
    <div id="map"></div>

    <script>
        // Initialize the map centered on an arbitrary location
        var map = L.map('map').setView([12.9716, 77.5946], 15); 

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Marker for the child's current location
        var childMarker = L.marker([12.9716, 77.5946]).addTo(map)
            .bindPopup("Child's Location").openPopup();

        // Safe zone circle (adjust as needed)
        var safeZoneCenter = [12.9716, 77.5946]; // Default safe zone center
        var safeZoneRadius = 500; // Radius in meters
        var safeZoneCircle = L.circle(safeZoneCenter, {
            color: "blue",
            fillColor: "#87CEFA",
            fillOpacity: 0.3,
            radius: safeZoneRadius
        }).addTo(map);

        function updateLocation(lat, lon) {
            var childLatLng = L.latLng(lat, lon);
            childMarker.setLatLng(childLatLng);
            map.setView(childLatLng, 15);

            // Calculate distance to safe zone center
            var distance = childLatLng.distanceTo(L.latLng(safeZoneCenter));

            if (distance > safeZoneRadius) {
                document.getElementById("alertBox").style.display = "block";
                document.getElementById("status").innerHTML = "ðŸš¨ OUTSIDE Safe Zone!";
                document.getElementById("status").style.color = "red";
            } else {
                document.getElementById("alertBox").style.display = "none";
                document.getElementById("status").innerHTML = "âœ… Inside Safe Zone";
                document.getElementById("status").style.color = "green";
            }
        }

        // Function to fetch data from ESP32
        function fetchLocation() {
            fetch("https://your-website.com/get_location") // Replace with actual API
                .then(response => response.json())
                .then(data => {
                    if (data.lat && data.lon) {
                        updateLocation(data.lat, data.lon);
                    }
                })
                .catch(error => console.error("Error fetching location:", error));
        }

        // Auto-refresh location every 10 seconds
        setInterval(fetchLocation, 10000);
    </script>

</body>
</html>
